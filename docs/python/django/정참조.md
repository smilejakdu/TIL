# ì •ì°¸ì¡°

### ì˜ˆì œ DB

```python
# ìœ ì €ëª©ë¡ í…Œì´ë¸”, ì‚¬ìš©ìì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ ì €ì¥í•œë‹¤.
class User(models.Model):
    # PK, unique, AI ìë™ìƒì„±
    # ì§ì ‘ ì§€ì • : id = models.AutoField(verbose_name='ID', serialize=False, auto_created=True, primary_key=True)
    user_name   = models.CharField(max_length=50)
    password    = models.CharField(max_length=200)
    # ì§€ê¸ˆ Userí…Œì´ë¸”ì—ì„œ userprofileì´ ì—­ì°¸ì¡° ë˜ê³  ìˆë‹¤. ì‚¬ìš©í•˜ê¸° ë¶ˆí¸ì“°!!..
    # Userê°€ Userprofileì„ ì •ì°¸ì¡°í•˜ëŠ”ê²ƒì´ ë°ì´í„° ì ‘ê·¼ ì´ ìš©ì´í•˜ë‹¤.. ì½”ë“œë„ ì‰½ê³µ
    class Meta:
        db_table = 'users'

# ìœ ì €ì˜ ì‚¬ì§„ê³¼, ìê¸°ì†Œê°œ ê¸€ì´ ë“±ë¡ëœ í…Œì´ë¸” ìœ ì €í…Œì´ë¸”ì˜ 1:1ê´€ê³„
class UserProfile(models.Model):
    user        = models.ForeignKey(User, on_delete=models.CASCADE, related_name='user_uniq_id')
    # ! related_nameì€ ì—­ì°¸ì¡°ì‹œ ì‚¬ìš©, ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ ì—­ì°¸ì¡°ëŠ” í…Œì´ë¸”ëª…ì†Œë¬¸ì_setìœ¼ë¡œ ì—­ì°¸ì¡°ë¥¼ ì°¾ì•„ê°„ë‹¤.
    image_url   = models.CharField(max_length=300, null=True)
    description = models.CharField(max_length=100, null=True)

    class Meta:
        db_table = 'user_profile'

# ì¸ìŠ¤íƒ€ê·¸ë¨ í”¼ë“œ í…Œì´ë¸”, ìœ ì €ì˜ ì´ë¦„, í”„ë¡œí•„ì‚¬ì§„, ëŒ“ê¸€ ì •ë³´ë¥¼ ì™¸ë¶€ì—ì„œ ê°€ì ¸ì™€ì•¼ í•œë‹¤.
class Feed(models.Model):
    user         = models.ForeignKey('account.User', on_delete = models.CASCADE, related_name = 'author')
                   # ? user, user_profileì´ 1:1ì¼ë•Œ êµ³ì´ user_profileì»¬ëŸ¼ì„ ì¶”ê°€í•  í•„ìš”ì—†ë‹¤..!
                   # user_profile = models.ForeignKey('account.UserProfile', on_delete = models.SET_NULL, null = True, related_name = 'avatar')
    image_url    = models.CharField(max_length = 300, verbose_name = 'image')
    content      = models.TextField(verbose_name = 'content')
    like         = models.IntegerField(verbose_name = 'likes', null = True)
    comment      = models.ManyToManyField('Comment', through = 'FeedComment', related_name = 'feed_comment')
    feed         = models.ManyToManyField('Feed', through = 'FeedComment', related_name = 'comment_feed')

    class Meta:
        db_table = 'feeds'
```

### ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

```python
# ë‹¨ìˆœíˆ í…Œì´ë¸”ì˜ ê°’ì„ ê°€ì ¸ì˜¤ê³  ì‹¶ì„ë•Œ
Feed.objects.get(id=1).image_url
# <í…Œì´ë¸”A>.<í…Œì´ë¸”A FKì¸ ì»¬ëŸ¼A>.<ì»¬ëŸ¼Aê°€ ë°”ë¼ë³´ëŠ” í…Œì´ë¸”ì˜ ì»¬ëŸ¼ì´ë¦„>
Feed.user.user_name
```

### select_related

ì…€ë ‰íŠ¸í•  ê°ì²´ê°€ ì—­ì°¸ì¡° í•˜ëŠ” single object(one to one , one to many) ì´ê±°ë‚˜ , ë˜ëŠ” ì •ì°¸ì¡° foreign key ì¼ ë•Œ ì‚¬ìš©í•œë‹¤.

- parameter ì—ëŠ” ì°¸ì¡°í•˜ëŠ” class ì˜ ì´ë¦„ì„ ì†Œë¬¸ìë¡œ ì“°ê³  ''ì— ê°ì‹¼ë‹¤
- ì—¬ëŸ¬ê°œì˜ paramter ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.

```python
from django.db import models

class Category(models.Model):
    name = models.CharField(max_length=50)

    class Meta:
        db_table = "categories"

class SubCategory(models.Model):
    name = models.CharField(max_length = 50)
    category = models.ForeignKey("Category" , on_delete= models.SET_NULL , null = True)

    class Meta:
        db_table = "sub_categories"

class Drink(models.Model):
    name_en     = models.CharField(max_length = 100)
    name_kr     = models.CharField(max_length = 100)
    description = models.CharField(max_length=500)
    category = models.ForeignKey("Category" , on_delete=models.SET_NULL , null = True)
    allergy = models.ManyToManyField("Allergy" , through = "DrinkAllergy")

    class Meta:
        db_table = "drinks"

class Allergy(models.Model):
    name = models.CharField(max_length = 50)

    class Meta:
        db_table = "allergies"

class DrinkAllergy(models.Model):
    drink = models.ForeignKey("drink" , on_delete=models.SET_NULL , null = True)
    allergy = models.ForeignKey("Allergy" , on_delete=models.SET_NULL , null = True)

    class Meta:
        db_table = "drink_allergys"

```

```python
@ manage.py shell
>>> from drink.models import *

# select_relatedë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì€ ê²½ìš°
>>> drink = Drink.objects.get(id=1) ğŸ¯                                [1]
>>> drink
<Drink: dolce cold brew>
>>> SubCategory.objects.filter(id=drink.sub_category_id)              [2]
<QuerySet [<SubCategory: cold brew>]>
>>> SubCategory.objects.filter(id=drink.sub_category_id)[0] ğŸ¯        [3]
<SubCategory: cold brew>
>>> SubCategory.objects.filter(id=drink1.sub_category_id)[0].name ğŸ¯  [4]
'cold brew'

# selected_relatedë¥¼ ì‚¬ìš©í•œ ê²½ìš°
>>> drink_sr = Drink.objects.select_related('sub_category').get(id=1) ğŸ¯   [a]
>>> drink_sr
<Drink: dolce cold brew>
>>> drink_sr.sub_category.name                                               [b]
'cold brew'
```

ë‹¨ìˆœíˆ ì½”ë“œ ê¸¸ì´ì˜ ì°¨ì´ê°€ ìˆì„ê¹Œ ??

drink ê°ì²´ë¥¼ ì§€ì •í•  ë•Œ , ì´ë¯¸ ê·¸ì˜ ê´€ê³„ë˜ëŠ” (related) sub_category ì˜ ì •ë³´ë“¤ì„ ë¶ˆëŸ¬ì™”ìœ¼ë¯€ë¡œ , DB ë¥¼ hit í•œë‹¤.
